<!DOCTYPE html>
<html lang="pt=br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="/stylesheets/estilo.css" />
    <script src="https://kit.fontawesome.com/b99e675b6e.js"></script>
    <script src="/javascripts/jquery-3.4.1.js"></script>
    <title>Gerenciador de Despachos</title>
    <script>
        function descompor(id) {            
            console.log("O botao que você clicou é referente a viatura " + id);
            var data = {};
            data.id = id;
            $.ajax({
            url: '/equipes/descompor',
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(data)}).then((resposta)=>{
                console.log(resposta);
                if(resposta==="sucesso")window.location.reload();
            });
        }
        async function descomporSemJquery(id){
            var data = {};
            data.id = id;
            const response = await fetch("/equipes/descompor", {
                method: "POST",
                mode: "cors", 
                cache: "no-cache", 
                credentials: "same-origin", 
                headers: {"Content-Type":"application/json"},
                redirect: "follow", 
                referrerPolicy: "no-referrer", 
                body: JSON.stringify(data)
            });
            if(response) window.location.reload();
        }
    </script>
</head>

<%- include("cabecalho.ejs") %>

    <body id="equipesBody">

        <%- include("sidebar.ejs") %>
            <div class="main_content">
                <div class="header">
                    <h1>Compor equipes</h1>
                </div>
                <div class="main_body">
                    Nova equipe:
                    <div class="inserirEquipeNova">
                        <form action="/equipes" method="POST">
                            <table>
                                <tr>
                                    <td>Viatura</td>
                                    <td><input type="text" name="viaturaInputText" id="viaturaInputText" required></td>
                                </tr>
                                <tr>
                                    <td>Comandante</td>
                                    <td><input type="text" name="comandanteInputText" id="comandanteInputText" required>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Motorista</td>
                                    <td><input type="text" name="motoristaInputText" id="motoristaInputText" required>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Patrulheiro1</td>
                                    <td><input type="text" name="patrulheiro1InputText" id="patrulheiro1InputText"></td>
                                </tr>
                                <tr>
                                    <td>Patrulheiro 2</td>
                                    <td><input type="text" name="patrulheiro2InputText" id="patrulheiro2InputText"></td>
                                </tr>
                                <tr>
                                    <td><button type="submit">Inserir</button></td>
                                </tr>
                            </table>
                        </form>
                    </div>

                    <div>
                        <table class="tableequipes">
                            <thead>
                                <tr>
                                    <th>Viatura</th>
                                    <th>Comandante</th>
                                    <th>Motorista</th>
                                    <th>Patrulheiro 1</th>
                                    <th>Patrulheiro 2</th>
                                    <th>Status</th>
                                    <th>Descompor</th>
                                </tr>
                            </thead>
                            <tbody>

                                <% for(var equipe of dados){ %>
                                    <tr>
                                        <td>
                                            <%=equipe.viatura%>
                                        </td>
                                        <td>
                                            <%=equipe.comandante%>
                                        </td>
                                        <td>
                                            <%=equipe.motorista%>
                                        </td>
                                        <td>
                                            <%=equipe.patrulheiro1%>
                                        </td>
                                        <td>
                                            <%=equipe.patrulheiro2%>
                                        </td>
                                        <td>
                                            <%=equipe.status%>
                                        </td>
                                        <td><button onclick=descomporSemJquery(<%=equipe.viatura%>)>Descompor</button>
                                        </td>
                                    </tr>
                                    <% } %>

                            </tbody>
                        </table>
                    </div>

                </div>
            </div>


    </body>
    <footer>

    </footer>

</html>